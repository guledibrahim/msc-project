<!DOCTYPE html>
<html>
   <head>
      <title>RadViz</title>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
      <link rel="stylesheet" type="text/css" href="style.css">
      <script src="radviz.js"></script>
      <script src="https://d3js.org/d3.v3.min.js"></script> 
   </head>
   <body>

 
      <nav class="nav justify-center">
         <h1 >NCD-RisC RadViz Visualization</h1>
      </nav>

      

<!--HTML elements-->
         <div class="fluid-container">
            <div class="row">
               <div class="col-md-12">
                  <!--<h1 class="text-center">NCD-RisC RadViz Visualization</h1>-->
                  <div class="text-center" id="vis">

                  

                     <!--region section-->
                     <form>
                        <h6>Region</h6>
                        <table>
                           <tr>
                              <td>
                                 <p>North America&nbsp; 
                                 <input type="checkbox"  class="Region" name="NA" id="NA" value="North America"></p>
                              </td>
                           </tr>

                           <tr>
                              <td>
                                 <p>Central Latin America&nbsp;<input type="checkbox"  class="Region"  id="CLA" name="CLA" value="Central Latin America"></p>
                              </td>
                           </tr>

                           <tr>   
                              <td>
                                 <p>Commonwealth Carribbean&nbsp;<input type="checkbox" class="Region"  id="CC" name="CC" value="Commonwealth Caribbean"></p>
                              </td>
                           </tr>

                           <tr>
                              <td>
                                 <p>Carribbean&nbsp;<input type="checkbox" name="CARB"  class="Region" id="CARB" value="Caribbean"></p>
                              </td>
                            </tr>  

                            <tr>
                              <td>                         
                                <p>Andean Latin America&nbsp;<input type="checkbox"  class="Region" id="ALA" name="ALA" value="Andean Latin America"></p>
                              </td>
                            </tr>
                            
                            <tr>  
                              <td>
                                 <p>Southern Latin America&nbsp;<input type="checkbox"  class="Region" id="SLA" name="SLA" value="Southern Latin America"></p>
                              </td>
                           </tr>
                        </table>
                     </form>

                     <!--year filter-->
                     <form">
                        <h6">Year</h6>
                        <table>
                           <tr>
                              <td>
                                 <p>1990 <input type="checkbox" name="year" value="1990" class="Year"></p>
                              </td>
                              <td>
                                 <p>1991 <input type="checkbox" name="year" value="1990" id="1991" class="Year"></p>
                              </td>
                              <td>
                                 <p>1992 <input type="checkbox" name="year" value="1990" id="1992" class="Year"></p>
                              </td>
                           </tr>
                           <tr>
                              <td>
                                 <p>1993 <input type="checkbox" name="year" value="1990" class="Year"></p>
                              </td>
                              <td>
                                 <p>1994 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                              </td>
                              <td>
                                 <p>1995 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                              </td>
                              <tr>
                                 <td>
                                    <p>1996 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                                 </td>
                                 <td>
                                    <p>1997 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                                 </td>
                                 <td>
                                    <p>1998 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                                 </td>
                              </tr>
                              <tr>
                              <td>
                                  <p>1999 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                              </td>
                              <td>
                                  <p>2000 <input type="checkbox" name="year" value="1990"  class="Year"></p>
                              </td>
                              </tr>
                           </tr>
                        </table>
                     </form>


                     <!--gender section-->
                     <form>
                        <h6>Gender</h6>
                        <table>
                           <tr>
                              <td>
                              <p style="float: left; margin: 0; padding: 10px 10px 0px 10px;">Male <input type="checkbox" id="maleCheck" class="Gender" name="Male" value="Male"></p>
                              </td>
                              <td>
                                 <p style="float: left; margin: 0; padding: 10px 10px 0px 10px;">Female <input type="checkbox" name="Female" class="Gender" id="femaleCheck" value="Female"></p>
                              </td>
     
                           </tr>
                        </table>
                     </form>

                    <!--command buttons--> 
                   <button onclick='dataFilter()'>Apply</button>



                  </div>
                  <div id="tooltip"></div>
               </div>
            </div>
         </div>


<!--radviz javascript implementation-->
      <script type="text/javascript"> 
  
//array of checkedbox elements
function getRegionCheckedBoxes() {
    var checkboxes = document.getElementsByClassName('Region');
    var checkedBoxes = [];

    //console.log('checkboxes',checkboxes);

    for (i = 0; i < checkboxes.length; i++) {

        if (checkboxes[i].checked == true)

            checkedBoxes.push(checkboxes[i].defaultValue);
    }

    return checkedBoxes;
}

//function to get all checked boxes for both male and female
function getGenderCheckedBoxes() {
    var genderCheckB = document.getElementsByClassName('Gender');
    var genderCheckedB = [];

    //console.log('genderCheckB', genderCheckB);

    for (i = 0; i < genderCheckB.length; i++) {
        if (genderCheckB[i].checked == true) {

            genderCheckedB.push(genderCheckB[i].defaultValue);
        }
    }

    return genderCheckedB;
}

var dimensions = ['Diabetes', 'Raised BP', 'Obesity'];
var radviz = radvizComponent()
    .config({
        el: document.querySelector('#vis'),
        colorAccessor: function(d) {
            return d['Sex'];
        },
        dimensions: dimensions,
        size: 200,
        margin: 100,
        dotRadius: 3,
        zoomFactor: 1,
        drawLinks: false,
        useRepulsion: true,
        tooltipFormatter: function(d) {
            return '<h1>' + d.Country +
                '</h1>' + '<br/>' + '<b>' + 'Region' + '</b>' + ' : ' + d.Region + '</br>' + '<b>' + 'Sex' + '</b>' + ' : ' + d.Sex + '<br/>' + '<b>' + 'Year' + '</b>' + ' : ' + d.Year + '<br/>' +
                dimensions.map(function(dB) {
                    return '<b>' + dB + ' : ' + '</b>' + d[dB];
                }).join('<br />');
        }
    });

d3.csv("NCD_RisC.csv", function(error, data) {
    radviz.render(data);
});


function dataFilter() {

    //clear svg canvas
    d3.select("svg").remove();

    //get a checked checkboxes and store them inside an Array
    var regions = [];
    regions = getRegionCheckedBoxes();

    var genders = [];
    genders = getGenderCheckedBoxes();

    console.log("genders",genders);
    //console.log("genders", genders);


    //filtering based on regions that are checked
    d3.csv("NCD_RisC.csv", function(data) {
        dataset = data.filter(function(d) {

      // condition checks if both region and gender are selected     
      if( regions.indexOf(d['Region'])>-1 && genders.indexOf(d['Sex'])>-1){
         return  genders.indexOf(d['Sex'])>-1;
      } else 

      //if region is checked and gender is not checked show region only
      if((regions.indexOf(d['Region'])>-1) && genders.indexOf(d['Sex'])<-1){ 
         return regions.indexOf(d['Region'])>-1;
      }else 

      // if region is not checked and gender is checked show all male/female 
      if((regions.indexOf(d['Region'])<-1) && (genders.indexOf(d['Sex'])>-1) ){
            return genders.indexOf(d['Sex'])>-1;
      }

   });

        radviz.render(dataset);

    });
}
      </script>
   </body>
</html>


